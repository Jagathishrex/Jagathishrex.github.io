{"hash":"40d5a017cb271761700a8ea3fe775477dafeabda","data":{"post":{"title":"Add new columns to table in PostgreSQL","date":"May 29, 2020","content":"<h2 id=\"adding-columns\"><a href=\"#adding-columns\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>Adding columns</h2>\n<p>We can combine <code>ALTER TABLE</code> &#x26; <code>ADD COLUMN</code> to add new columns to an existing table.</p>\n<pre class=\"shiki\" style=\"background-color: #292D3E\"><code><span style=\"color: #F78C6C\">ALTER</span><span style=\"color: #FFFFFF\"> </span><span style=\"color: #F78C6C\">TABLE</span><span style=\"color: #FFFFFF\"> table_name</span>\n<span style=\"color: #FFFFFF\">ADD COLUMN  column_name1 data_type,</span>\n<span style=\"color: #FFFFFF\">ADD COLUMN  column_name1 data_type,</span>\n<span style=\"color: #FFFFFF\">Constraints;</span></code></pre>\n<p>Let's say we have a table <code>user</code>, with <code>name</code> and <code>age</code> , Now we need to add a new column <code>phone_number</code>.</p>\n<pre class=\"shiki\" style=\"background-color: #292D3E\"><code><span style=\"color: #F78C6C\">alter</span><span style=\"color: #FFFFFF\"> </span><span style=\"color: #F78C6C\">table</span><span style=\"color: #FFFFFF\"> user</span>\n<span style=\"color: #FFFFFF\">add column phone_number </span><span style=\"color: #C792EA\">bigint</span><span style=\"color: #FFFFFF\">;</span></code></pre>\n<h2 id=\"adding-multiple-columns\"><a href=\"#adding-multiple-columns\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>Adding multiple columns</h2>\n<p>Consider we need to add two more columns, <code>salary</code> and <code>nickname</code></p>\n<pre class=\"shiki\" style=\"background-color: #292D3E\"><code><span style=\"color: #F78C6C\">ALTER</span><span style=\"color: #FFFFFF\"> </span><span style=\"color: #F78C6C\">TABLE</span><span style=\"color: #FFFFFF\"> user</span>\n<span style=\"color: #FFFFFF\">ADD COLUMN salary </span><span style=\"color: #C792EA\">int</span><span style=\"color: #FFFFFF\">,</span>\n<span style=\"color: #FFFFFF\">ADD COLUMN nickname </span><span style=\"color: #C792EA\">varchar</span><span style=\"color: #FFFFFF\">;</span></code></pre>\n<h2 id=\"add-column-if-not-present\"><a href=\"#add-column-if-not-present\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>Add Column if not present</h2>\n<p>With Postgres 9.6 this can be done using the option if not exists</p>\n<pre class=\"shiki\" style=\"background-color: #292D3E\"><code><span style=\"color: #F78C6C\">ALTER</span><span style=\"color: #FFFFFF\"> </span><span style=\"color: #F78C6C\">TABLE</span><span style=\"color: #FFFFFF\"> table_name</span>\n<span style=\"color: #FFFFFF\">ADD COLUMN IF NOT EXISTS column_name data_type;</span></code></pre>\n<h2 id=\"adding-with-constraints\"><a href=\"#adding-with-constraints\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>Adding with constraints</h2>\n<pre class=\"shiki\" style=\"background-color: #292D3E\"><code><span style=\"color: #F78C6C\">ALTER</span><span style=\"color: #FFFFFF\"> </span><span style=\"color: #F78C6C\">TABLE</span><span style=\"color: #FFFFFF\"> table_name</span>\n<span style=\"color: #FFFFFF\">ADD COLUMN column_name datatype</span>\n<span style=\"color: #FFFFFF\">constraints;</span></code></pre>\n<p>Let's say we need to add a default value to a column.</p>\n<pre class=\"shiki\" style=\"background-color: #292D3E\"><code><span style=\"color: #F78C6C\">Alter</span><span style=\"color: #FFFFFF\"> </span><span style=\"color: #F78C6C\">table</span><span style=\"color: #FFFFFF\"> user</span>\n<span style=\"color: #FFFFFF\">add column isAlive </span><span style=\"color: #C792EA\">boolean</span><span style=\"color: #FFFFFF\"> default true;</span></code></pre>\n<p>To add a not null constraint you need to set <code>default value</code> because, When you add new column PostgreSQL takes the <code>NULL</code> as column value for the existing row, which violates the <code>NOT NULL</code> constraint.</p>\n<pre class=\"shiki\" style=\"background-color: #292D3E\"><code><span style=\"color: #F78C6C\">Alter</span><span style=\"color: #FFFFFF\"> </span><span style=\"color: #F78C6C\">table</span><span style=\"color: #FFFFFF\"> user</span>\n<span style=\"color: #FFFFFF\">add column isAlive </span><span style=\"color: #C792EA\">boolean</span><span style=\"color: #FFFFFF\"> </span><span style=\"color: #F78C6C\">not null</span><span style=\"color: #FFFFFF\"> default true;</span></code></pre>\n<p>If you don't want the default value</p>\n<ul>\n<li>Add a column with the default value constraint </li>\n</ul>\n<pre class=\"shiki\" style=\"background-color: #292D3E\"><code><span style=\"color: #F78C6C\">Alter</span><span style=\"color: #FFFFFF\"> </span><span style=\"color: #F78C6C\">table</span><span style=\"color: #FFFFFF\"> user</span>\n<span style=\"color: #FFFFFF\">add column isAlive </span><span style=\"color: #C792EA\">boolean</span><span style=\"color: #FFFFFF\"> </span><span style=\"color: #F78C6C\">not null</span><span style=\"color: #FFFFFF\"> default true;</span>\n<span style=\"color: #FFFFFF\">Then remove the default value </span><span style=\"color: #C792EA\">constraint</span></code></pre>\n<ul>\n<li>Then remove the default value constraint</li>\n</ul>\n<pre class=\"shiki\" style=\"background-color: #292D3E\"><code><span style=\"color: #F78C6C\">ALTER</span><span style=\"color: #FFFFFF\"> </span><span style=\"color: #F78C6C\">TABLE</span><span style=\"color: #FFFFFF\"> user</span>\n<span style=\"color: #FFFFFF\">ALTER COLUMN isAlive</span>\n<span style=\"color: #FFFFFF\">DROP DEFAULT;</span><span style=\"color: #89DDFF\">```</span></code></pre>\n","tags":[{"title":"PostgreSQL","path":"/tag/PostgreSQL/"},{"title":"database","path":"/tag/database/"},{"title":"SQL","path":"/tag/SQL/"}]}},"context":{}}